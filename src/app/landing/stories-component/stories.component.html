<!-- Embolcalla tot amb *ngIf per esperar les dades -->
<div class="stories-container" *ngIf="hasData">
  <!-- Header -->
  <div class="header">
    <!-- Imatge de perfil (amb *ngIf opcional per mÃ©s seguretat) -->
    <div class="profile-image" style="background: purple">
      {{ currentUser.name[0] }}
    </div>
    <!-- Placeholder si no hi ha imatge? -->
    <!-- Ajusta la ruta al teu placeholder -->

    <!-- Nom d'usuari -->
    <span class="user-name">{{ currentUser.name }} <small>{{ currentUser.uploaded_at }}</small></span>

    <!-- Barres de ProgrÃ©s (CORREGIT EL *ngFor) -->
    <div class="progress-bars">
      <!-- Itera sobre l'array d'histÃ²ries -->
      <div
        *ngFor="let story of currentUser.stories; let i = index"
        class="progress-bar-wrapper"
      >
        <div class="progress-bar-background">
          <!-- La lÃ²gica de l'ample sembla correcta -->
          <div
            class="progress-bar-foreground"
            [style.width.%]="
              i === currentStoryIndex
                ? progress
                : i < currentStoryIndex
                ? 100
                : 0
            "
          ></div>
        </div>
      </div>
    </div>

    <!-- BotÃ³ de tancar -->
    <button
      (click)="closeStories()"
      class="close-button"
      aria-label="Tancar histÃ²ries"
    >
      Ã—
    </button>
    <!-- Millora accessibilitat amb aria-label -->
  </div>

  <!-- Contingut de la histÃ²ria -->
  <!-- Contingut de la histÃ²ria -->
  <div
    class="story-content"
    (mousedown)="pauseTimerOnPress($event)"
    (touchstart)="pauseTimerOnPress($event)"
    (mouseup)="resumeTimerOnRelease()"
    (touchend)="resumeTimerOnRelease()"
    (mouseleave)="resumeTimerOnRelease()"
    >
    <!-- NavegaciÃ³ (click a l'esquerra/dreta de la imatge) -->
    <!-- Important: Aturem la propagaciÃ³ d'esdeveniments aquÃ­ per evitar -->
    <!-- que els clics de navegaciÃ³ tambÃ© pausinn/reprenguin el timer -->
    <div
      class="navigation-overlay left"
      (click)="prevStory(); $event.stopPropagation()"
    ></div>
    <div
      class="navigation-overlay right"
      (click)="nextStory(); $event.stopPropagation()"
    ></div>

    <!-- Imatge de la histÃ²ria -->
    <div class="story-image-container">
      <img
        *ngIf="currentStory.imageUrl"
        [src]="currentStory.imageUrl"
        alt="Story"
        class="story-image"
        draggable="false"
      />
      <div *ngIf="!currentStory.imageUrl" class="no-image-placeholder">
        Imatge no disponible
      </div>
    </div>
  </div>

  <!-- Controls inferiors (opcional si ja tens navegaciÃ³ per clic a la imatge) -->
  <!--
  <div class="controls">
    <button (click)="prevStory()" class="nav-button" [disabled]="currentUserIndex === 0 && currentStoryIndex === 0"> < Anterior</button>
    <button (click)="nextStory()" class="nav-button" [disabled]="currentUserIndex === stories.length - 1 && currentStoryIndex === currentUser.stories.length - 1">SegÃ¼ent ></button>
  </div>
  -->

  <!-- Vots -->
  <div class="votes">
    <button
      (click)="voteUp()"
      class="vote-button positive"
      aria-label="Vot positiu"
    >
      ğŸ‘
    </button>
    <!-- Afegeix el botÃ³ de vot negatiu si el necessites -->
    <!-- <button (click)="voteDown()" class="vote-button negative" aria-label="Vot negatiu">ğŸ‘</button> -->
    <span class="vote-count"
      >Vots positius:
      {{ currentStory.votsPositius ? currentStory.votsPositius : 0 }}</span
    >
    <!-- Mostra altres comptes si cal -->
  </div>
</div>

<!-- Indicador de cÃ rrega (es mostra si hasData Ã©s false) -->
<div class="loading-indicator" *ngIf="!hasData">
  <p>Carregant...</p>
  <!-- Podries posar un spinner aquÃ­ -->
</div>
