<!-- Embolcalla tot amb *ngIf per esperar les dades -->
<div class="stories-container" *ngIf="hasData">
  <!-- Header -->
  <div class="header">
    <!-- Imatge de perfil (Mant√© la teva l√≤gica original) -->
    <div class="profile-image" style="background: purple">
      <!-- Accedeix directament a la propietat 'name' del getter 'currentUser' -->
      {{ currentUser.name ? currentUser.name[0] : "?" }}
    </div>

    <!-- Nom d'usuari i temps -->
    <span class="user-name">
      {{ currentUser.name }}
      <!-- *** CANVI: Utilitza el DatePipe nadiu d'Angular *** -->
      <!-- Formats possibles: 'shortTime', 'mediumDate', 'longDate', 'dd/MM/yy HH:mm', etc. -->
      <!-- Assegura't que currentStory.uploaded_at √©s una data v√†lida (Date object, ISO string, timestamp) -->
      <small class="story-time" style="font-size: 10px;" *ngIf="currentStory.uploaded_at">
        {{ currentStory.uploaded_at | relativeTime }}
      </small>
    </span>

    <!-- Barres de Progr√©s (Mant√© la teva l√≤gica original) -->
    <div class="progress-bars">
      <!-- Itera sobre les hist√≤ries via el getter 'currentUser' -->
      <div
        *ngFor="let story of currentUser.stories; let i = index"
        class="progress-bar-wrapper"
      >
        <div class="progress-bar-background">
          <!-- L'ample utilitza el getter 'progress' -->
          <div
            class="progress-bar-foreground"
            [style.width.%]="
              i === currentStoryIndex
                ? progress
                : i < currentStoryIndex
                ? 100
                : 0
            "
          ></div>
        </div>
      </div>
    </div>

    <!-- Bot√≥ de tancar (Mant√© la teva l√≤gica original) -->
    <button
      (click)="closeStories()"
      class="close-button"
      aria-label="Tancar hist√≤ries"
    >
      √ó
    </button>
  </div>

  <!-- Contingut de la hist√≤ria -->
  <div
    class="story-content"
    (panstart)="pauseTimerOnPress($any($event))"
    (panend)="resumeTimerOnRelease()"
    (pancancel)="resumeTimerOnRelease()"
    (swipeleft)="handleSwipe($any($event))"
    (swiperight)="handleSwipe($any($event))"
    (swipedown)="handleSwipe($any($event))"
    role="region"
    aria-label="Contingut de la hist√≤ria"
    (mousedown)="pauseTimerOnPress($event)"
    (touchstart)="pauseTimerOnPress($event)"
    (mouseup)="resumeTimerOnRelease()"
    (touchend)="resumeTimerOnRelease()"
    (mouseleave)="resumeTimerOnRelease()"
  >
    <!-- Navegaci√≥ per clic/tap (Mant√© la teva l√≤gica original) -->
    <div
      class="navigation-overlay left"
      (click)="prevStory(); $event.stopPropagation()"
      aria-label="Hist√≤ria anterior"
    ></div>
    <div
      class="navigation-overlay right"
      (click)="nextStory(); $event.stopPropagation()"
      aria-label="Hist√≤ria seg√ºent"
    ></div>

    <!-- Imatge de la hist√≤ria (Mant√© la teva l√≤gica original) -->
    <div class="story-image-container">
      <!-- Utilitza el getter 'currentStory' que ja resol la URL -->
      <img
        *ngIf="currentStory.imageUrl"
        [src]="currentStory.imageUrl"
        [alt]="'Hist√≤ria de ' + currentUser.name"
        class="story-image"
        draggable="false"
      />
      <div *ngIf="!currentStory.imageUrl" class="no-image-placeholder">
        Imatge no disponible
      </div>
    </div>
  </div>

  <!-- Controls inferiors (Comentats, com al teu original) -->
  <!--
  <div class="controls">
    <button (click)="prevStory()" class="nav-button" [disabled]="currentUserIndex === 0 && currentStoryIndex === 0"> < Anterior</button>
    <button (click)="nextStory()" class="nav-button" [disabled]="currentUserIndex === stories.length - 1 && currentStoryIndex === currentUser.stories.length - 1">Seg√ºent ></button>
  </div>
  -->

  <!-- Vots (Mant√© la teva l√≤gica original) -->
  <div class="votes">
    <button
      (click)="voteUp()"
      class="vote-button positive"
      aria-label="Vot positiu"
    >
      üëç
    </button>
    <!-- Afegeix el bot√≥ de vot negatiu si el necessites -->
    <!-- <button (click)="voteDown()" class="vote-button negative" aria-label="Vot negatiu">üëé</button> -->
    <span class="vote-count">
      Vots positius:
      <!-- Accedeix al camp de vots (ajusta 'votes' o 'votsPositius' segons la teva dada real) -->
      {{
        currentStory.votes
          ? currentStory.votes
          : currentStory.votsPositius
          ? currentStory.votsPositius
          : 0
      }}
    </span>
  </div>
</div>

<!-- Indicador de c√†rrega (Mant√© la teva l√≤gica original) -->
<div class="loading-indicator" *ngIf="!hasData">
  <p>Carregant...</p>
  <!-- Podries posar un spinner aqu√≠ -->
</div>
