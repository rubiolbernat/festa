<!-- Embolcall Principal: Nom√©s es mostra si hi ha dades v√†lides i els getters retornen valors -->
<div
  class="stories-container"
  *ngIf="hasData && currentUserHeaderData && currentStorySlide"
>
  <!-- ===== Cap√ßalera (Header) ===== -->
  <div class="header">
    <!-- Imatge de perfil (Estil original amb inicials) -->
    <div class="profile-image" style="background: purple">
      <!-- Accedeix al nom via el getter correcte i obt√© la inicial -->
      {{ currentUserHeaderData.userName ? currentUserHeaderData.userName[0] :
      "?" }}
    </div>

    <!-- Nom d'usuari i temps -->
    <span class="user-name">
      <!-- Accedeix al nom via el getter correcte -->
      {{ currentUserHeaderData.userName }}
      <!-- Temps relatiu de la slide actual -->
      <small
        class="story-time"
        style="font-size: 10px"
        *ngIf="currentStorySlide.uploadedAt"
      >
        <!-- Accedeix a la data via el getter correcte -->
        {{ currentStorySlide.uploadedAt | relativeTime }}
      </small>
    </span>

    <!-- Barres de Progr√©s -->
    <div class="progress-bars">
      <!-- Itera sobre les slides de l'usuari actual usant el getter correcte -->
      <div
        *ngFor="let slide of currentUserSlidesForProgress; let i = index"
        class="progress-bar-wrapper"
      >
        <div class="progress-bar-background">
          <!-- La l√≤gica de l'amplada √©s correcta, utilitza 'progress', 'currentStoryIndex' i l'√≠ndex 'i' -->
          <div
            class="progress-bar-foreground"
            [style.width.%]="i === currentStoryIndex ? progress : (i < currentStoryIndex ? 100 : 0)"
          ></div>
        </div>
      </div>
    </div>

    <!-- Bot√≥ de tancar (Sense canvis de l√≤gica) -->
    <button
      (click)="closeStories()"
      class="close-button"
      aria-label="Tancar hist√≤ries"
    >
      √ó
      <!-- Car√†cter 'times' (X) -->
    </button>
  </div>

  <!-- ===== Contingut de la hist√≤ria (Gestors d'events i navegaci√≥ no canvien) ===== -->
  <div
    class="story-content"
    #storyContent
    role="region"
    aria-label="Contingut de la hist√≤ria"
  >
    <!-- Navegaci√≥ per clic/tap (Sense canvis de l√≤gica) -->
    <div
      class="navigation-overlay left"
      (click)="prevStory(); $event.stopPropagation()"
      aria-label="Hist√≤ria anterior"
    ></div>
    <div
      class="navigation-overlay right"
      (click)="nextStory(); $event.stopPropagation()"
      aria-label="Hist√≤ria seg√ºent"
    ></div>

    <!-- Imatge de la hist√≤ria -->
    <div class="story-image-container">
      <!-- Utilitza la URL de la slide actual via el getter correcte -->
      <img
        *ngIf="currentStorySlide.imageUrl"
        [src]="currentStorySlide.imageUrl"
        [alt]="'Hist√≤ria de ' + (currentUserHeaderData?.userName || 'usuari')"
        class="story-image"
        draggable="false"
      />
      <!-- Placeholder si la slide actual no t√© imatge -->
      <div *ngIf="!currentStorySlide.imageUrl" class="no-image-placeholder">
        Imatge no disponible
      </div>
    </div>
  </div>
  <!-- Fi story-content -->

  <!-- ===== Vots (Adaptat al model actual) ===== -->
  <!-- Col¬∑locat fora de .story-content si vols que estigui a sota -->
  <div class="votes">
    <button (click)="voteUp()" class="vote-button positive" aria-label="Vot positiu">
      üëç
    </button>

    <span class="vote-count">
      Vots: {{ currentStorySlide.votes || 0 }}
    </span>

    <div class="story-drink-info" *ngIf="currentStorySlide.drink">
      <span class="drink-location" *ngIf="currentStorySlide.drink.others">
        {{ currentStorySlide.drink.others }}
      </span>
      <span class="drink-name">{{ currentStorySlide.drink.name }}</span>
    </div>
  </div>

  <!-- Controls inferiors comentats (com a l'original) -->
  <!--
  <div class="controls">
    <button (click)="prevStory()" class="nav-button" [disabled]="currentUserIndex === 0 && currentStoryIndex === 0"> < Anterior</button>
    <button (click)="nextStory()" class="nav-button" [disabled]="currentUserIndex === stories.length - 1 && currentStoryIndex === ???">Seg√ºent ></button> -->
  <!-- Hauries d'usar currentUserSlidesForProgress.length aqu√≠ -->
  <!--</div>
  -->
</div>
<!-- Fi de stories-container *ngIf -->

<!-- Indicador de c√†rrega (Sense canvis) -->
<div class="loading-indicator" *ngIf="!hasData">
  <p>Carregant...</p>
  <!-- Podries posar un spinner aqu√≠ -->
</div>
